<!-- HTML header for doxygen 1.8.5-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>ejpp: Main Page</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="custom.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">ejpp
   </div>
   <div id="projectbrief">Embedded JSON Database engine for C++11/14</div>
  </td>
  <!-- github -->
  <a id="forkme_banner" href="https://github.com/chrismanning/ejpp">View on GitHub</a>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li class="current"><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">ejpp Documentation</div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#rationale">Rationale</a></li>
<li class="level1"><a href="#usage">Usage</a><ul><li class="level2"><a href="#qry">Queries</a></li>
<li class="level2"><a href="#trans">Transactions</a></li>
</ul>
</li>
<li class="level1"><a href="#install">Installation</a><ul><li class="level2"><a href="#reqs">Requirements</a></li>
<li class="level2"><a href="#build">Building</a><ul><li class="level3"><a href="#cmake">CMake Options</a></li>
</ul>
</li>
<li class="level2"><a href="#docs">Documentation</a></li>
<li class="level2"><a href="#test">Testing</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><p><a href="http://chrismanning.github.io/ejpp">ejpp</a> is a C++ wrapper for <a href="http://ejdb.org/">EJDB</a>.</p>
<h1><a class="anchor" id="rationale"></a>
Rationale</h1>
<p>EJDB is a C library, so why a C++ wrapper?</p>
<p>While the C library is indeed usable from C++, its usage is far from idiomatic. ejpp provides a safe and modern C++ interface, taking advantage of many C++ language and library features such as exceptions, RAII, reference counted memory management, containers, and more.</p>
<h1><a class="anchor" id="usage"></a>
Usage</h1>
<p>ejpp has three main classes, <code><a class="el" href="structejdb_1_1db.html" title="Main point of access to EJDB. ">ejdb::db</a></code>, <code><a class="el" href="structejdb_1_1collection.html" title="Class representing an EJDB collection. ">ejdb::collection</a></code>, and <code><a class="el" href="structejdb_1_1query.html" title="Class representing an EJDB query. ">ejdb::query</a></code>, which correspond to the opaque types <code>EJDB</code>, <code>EJCOLL</code>, and <code>EJQ</code>, respectively. Valid <code><a class="el" href="structejdb_1_1collection.html" title="Class representing an EJDB collection. ">ejdb::collection</a></code> and <code><a class="el" href="structejdb_1_1query.html" title="Class representing an EJDB query. ">ejdb::query</a></code> objects can only be created via <code><a class="el" href="structejdb_1_1db.html" title="Main point of access to EJDB. ">ejdb::db</a></code>; their default, or ill-constructed forms will give errors when attempting to perform operations on them.</p>
<p>ejpp does not impose a specific form of BSON data other than <code>std::vector&lt;char&gt;</code> so that it can be used with your favourite BSON library.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;ejpp/ejdb.hpp&gt;</span></div>
<div class="line"><span class="keyword">using namespace </span>ejdb;</div>
<div class="line"><span class="preprocessor">#include &lt;jbson/document.hpp&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;jbson/json_reader.hpp&gt;</span></div>
<div class="line"><span class="keyword">using namespace </span>jbson::literal;</div>
<div class="line"></div>
<div class="line"><a class="code" href="structejdb_1_1db.html">db</a> my_db;</div>
<div class="line">assert(!my_db.is_open());</div>
<div class="line"></div>
<div class="line"><span class="comment">// Open &quot;my_db&quot;. Throws std::system_error containing an EJDB error code on error.</span></div>
<div class="line">my_db.<a class="code" href="structejdb_1_1db.html#aef17315c461f36b3be3afd31141c98ff">open</a>(<span class="stringliteral">&quot;my_db&quot;</span>, <a class="code" href="namespaceejdb.html#ad82ea1eca5597c7e71118e54011644d3aecae13117d6f0584c25a9da6c8f8415e">db_mode::read</a> | <a class="code" href="namespaceejdb.html#ad82ea1eca5597c7e71118e54011644d3aefb2a684e4afb7d55e6147fbe5a332ee">db_mode::write</a> | <a class="code" href="namespaceejdb.html#ad82ea1eca5597c7e71118e54011644d3a76ea0bebb3c22822b4f0dd9c9fd021c5">db_mode::create</a> | <a class="code" href="namespaceejdb.html#ad82ea1eca5597c7e71118e54011644d3a244f58cf07c35fd48d7524b289551e5c">db_mode::truncate</a>);</div>
<div class="line"></div>
<div class="line"><a class="code" href="structejdb_1_1collection.html">collection</a> my_coll;</div>
<div class="line">assert(!my_coll);</div>
<div class="line"></div>
<div class="line"><span class="comment">// Open/create &quot;my_coll&quot; collection.</span></div>
<div class="line">std::error_code ec;</div>
<div class="line">my_coll = my_db.create_collection(<span class="stringliteral">&quot;my_coll&quot;</span>, ec);</div>
<div class="line">assert(!ec &amp;&amp; my_coll);</div>
<div class="line"></div>
<div class="line"><span class="comment">// Save some BSON data to a collection. Throws std::system_error containing an EJDB error code on error.</span></div>
<div class="line"><span class="keyword">auto</span> oid = my_coll.save_document(R<span class="stringliteral">&quot;({&quot;some key&quot;: &quot;some value&quot;})&quot;_json_doc.data());</span></div>
<div class="line"><span class="stringliteral"></span></div>
<div class="line"><span class="stringliteral"></span><span class="comment">// Load raw BSON data from collection into a jbson::document.</span></div>
<div class="line"><span class="comment">// Throws std::system_error containing an EJDB error code on error.</span></div>
<div class="line"><span class="keyword">auto</span> doc = jbson::document(my_coll.load_document(oid));</div>
<div class="line"></div>
<div class="line"><span class="keyword">auto</span> it = doc.find(<span class="stringliteral">&quot;some key&quot;</span>);</div>
<div class="line">assert(it != doc.end());</div>
<div class="line">assert(it-&gt;value&lt;<a class="code" href="namespaceejdb.html#ad717f714fc1b88575d9f2131b5ae8694ab45cffe084dd3d20d928bee85e7b0f21">std::string</a>&gt;() == <span class="stringliteral">&quot;some value&quot;</span>);</div>
</div><!-- fragment --><p> Many ejpp functions offer throwing and non-throwing overloads. Non-throwing overloads take an extra parameter, a non-const lvalue reference to a <code>std::error_code</code>.</p>
<h2><a class="anchor" id="qry"></a>
Queries</h2>
<p>Queries are handled in much the same way as EJDB. A <code><a class="el" href="structejdb_1_1query.html" title="Class representing an EJDB query. ">ejdb::query</a></code> object is created from a BSON document, and can then be manipulated (add hints, <code>$or</code> or <code>$and</code> conditions) and executed. Queries can be executed with several different flags which will change the behaviour and return type of the query result.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;ejpp/ejdb.hpp&gt;</span></div>
<div class="line"><span class="keyword">using namespace </span>ejdb;</div>
<div class="line"><span class="preprocessor">#include &lt;jbson/document.hpp&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;jbson/json_reader.hpp&gt;</span></div>
<div class="line"><span class="keyword">using namespace </span>jbson::literal;</div>
<div class="line"></div>
<div class="line"><a class="code" href="structejdb_1_1db.html">db</a> my_db;</div>
<div class="line">my_db.<a class="code" href="structejdb_1_1db.html#aef17315c461f36b3be3afd31141c98ff">open</a>(<span class="stringliteral">&quot;my_db&quot;</span>, <a class="code" href="namespaceejdb.html#ad82ea1eca5597c7e71118e54011644d3aecae13117d6f0584c25a9da6c8f8415e">db_mode::read</a> | <a class="code" href="namespaceejdb.html#ad82ea1eca5597c7e71118e54011644d3aefb2a684e4afb7d55e6147fbe5a332ee">db_mode::write</a>);</div>
<div class="line">assert(my_db.is_open());</div>
<div class="line"></div>
<div class="line"><a class="code" href="structejdb_1_1collection.html">collection</a> my_coll = my_db.get_collection(<span class="stringliteral">&quot;my_coll&quot;</span>);</div>
<div class="line">assert(my_coll);</div>
<div class="line"></div>
<div class="line">std::vector&lt;char&gt; bson_qry = R<span class="stringliteral">&quot;({&quot;some key&quot;: { &quot;$begin&quot;: &quot;some v&quot; }})&quot;_json_doc.data();</span></div>
<div class="line"><span class="stringliteral"></span></div>
<div class="line"><span class="stringliteral"></span><span class="keyword">auto</span> qry = my_db.create_query(bson_qry)</div>
<div class="line">                .set_hints(R<span class="stringliteral">&quot;({&quot;$max&quot;: 4})&quot;_json_doc.data()); </span><span class="comment">// Return no more than 4 matches.</span></div>
<div class="line"></div>
<div class="line"><span class="comment">// Return all matches, limited by hints only.</span></div>
<div class="line">std::vector&lt;std::vector&lt;char&gt;&gt; results = my_coll.execute_query(qry);</div>
<div class="line"><span class="comment">// same as </span></div>
<div class="line"><span class="comment">// std::vector&lt;std::vector&lt;char&gt;&gt; results = my_coll.execute_query&lt;query_search_mode::normal&gt;(qry);</span></div>
<div class="line"></div>
<div class="line"><span class="comment">// Just count the number of matches, don&#39;t bother assembling the documents. Handy for update queries.</span></div>
<div class="line">uint32_t no_results = my_coll.execute_query&lt;<a class="code" href="namespaceejdb.html#aceb78f5b01de913fbdc2656029276a75ab2794163428de72debe5efeca32f33f8">query_search_mode::count_only</a>&gt;(qry);</div>
<div class="line"></div>
<div class="line"><span class="comment">// Just return the first match. Empty vector on no matches.</span></div>
<div class="line">std::vector&lt;char&gt; first_result = my_coll.execute_query&lt;<a class="code" href="namespaceejdb.html#aceb78f5b01de913fbdc2656029276a75aa7190158c163d646ef94aa64518ad4e3">query_search_mode::first_only</a>&gt;(qry);</div>
<div class="line"></div>
<div class="line"><span class="comment">// Count only up to a maximum of one.</span></div>
<div class="line">uint32_t has_result = my_coll.execute_query&lt;<a class="code" href="namespaceejdb.html#aceb78f5b01de913fbdc2656029276a75aa7190158c163d646ef94aa64518ad4e3">query_search_mode::first_only</a>|<a class="code" href="namespaceejdb.html#aceb78f5b01de913fbdc2656029276a75ab2794163428de72debe5efeca32f33f8">query_search_mode::count_only</a>&gt;(qry);</div>
</div><!-- fragment --><h2><a class="anchor" id="trans"></a>
Transactions</h2>
<p>EJDB supports transactions at the collection level, and ejpp wraps this functionality via the class <code><a class="el" href="structejdb_1_1collection_1_1transaction__t.html" title="Represents an EJDB transaction. ">ejdb::collection::transaction_t</a></code>, which is contained within each <code><a class="el" href="structejdb_1_1collection.html" title="Class representing an EJDB collection. ">ejdb::collection</a></code>. This class alone provides no additional safety features, though with the help of <code><a class="el" href="structejdb_1_1transaction__guard.html" title="Simple collection::transaction_t wrapper for exception safe operation using RAII ">ejdb::transaction_guard</a></code> and <code><a class="el" href="structejdb_1_1unique__transaction.html" title="Defines an exception-safe wrapper around collection::transaction_t with unique ownership. ">ejdb::unique_transaction</a></code> ejpp provides exception safety using RAII. <code><a class="el" href="structejdb_1_1transaction__guard.html" title="Simple collection::transaction_t wrapper for exception safe operation using RAII ">ejdb::transaction_guard</a></code> and <code><a class="el" href="structejdb_1_1unique__transaction.html" title="Defines an exception-safe wrapper around collection::transaction_t with unique ownership. ">ejdb::unique_transaction</a></code> are mostly modelled after <code>std::lock_guard</code> and <code>std::unique_lock</code>, respectively.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;ejpp/ejdb.hpp&gt;</span></div>
<div class="line"><span class="keyword">using namespace </span>ejdb;</div>
<div class="line"><span class="preprocessor">#include &lt;jbson/document.hpp&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;jbson/json_reader.hpp&gt;</span></div>
<div class="line"><span class="keyword">using namespace </span>jbson::literal;</div>
<div class="line"></div>
<div class="line"><a class="code" href="structejdb_1_1db.html">db</a> my_db;</div>
<div class="line">my_db.<a class="code" href="structejdb_1_1db.html#aef17315c461f36b3be3afd31141c98ff">open</a>(<span class="stringliteral">&quot;my_db&quot;</span>, <a class="code" href="namespaceejdb.html#ad82ea1eca5597c7e71118e54011644d3aecae13117d6f0584c25a9da6c8f8415e">db_mode::read</a> | <a class="code" href="namespaceejdb.html#ad82ea1eca5597c7e71118e54011644d3aefb2a684e4afb7d55e6147fbe5a332ee">db_mode::write</a>);</div>
<div class="line">assert(my_db.is_open());</div>
<div class="line"></div>
<div class="line"><a class="code" href="structejdb_1_1collection.html">collection</a> my_coll = my_db.get_collection(<span class="stringliteral">&quot;my_coll&quot;</span>);</div>
<div class="line">assert(my_coll);</div>
<div class="line"></div>
<div class="line"><span class="keyword">using</span> oid_t = std::array&lt;char, 12&gt;;</div>
<div class="line"></div>
<div class="line">oid_t oid;</div>
<div class="line"></div>
<div class="line">{</div>
<div class="line">    <span class="comment">// Commits at scope exit, or aborts when an exception is thrown.</span></div>
<div class="line">    <span class="comment">// Cannot be manually committed or aborted.</span></div>
<div class="line">    <a class="code" href="structejdb_1_1transaction__guard.html">transaction_guard</a> gu(my_coll.transaction());</div>
<div class="line">    oid = my_coll.save_document(R<span class="stringliteral">&quot;({&quot;some other key&quot;: &quot;some other value&quot;})&quot;_json_doc.data());</span></div>
<div class="line"><span class="stringliteral">}</span></div>
<div class="line"><span class="stringliteral"></span></div>
<div class="line"><span class="stringliteral">assert(!my_coll.load_document(oid).empty());</span></div>
<div class="line"><span class="stringliteral"></span></div>
<div class="line"><span class="stringliteral"></span><span class="keywordflow">try</span> {</div>
<div class="line">    <span class="comment">// Commits at scope exit, or aborts when an exception is thrown.</span></div>
<div class="line">    <span class="comment">// Cannot be manually committed or aborted.</span></div>
<div class="line">    <a class="code" href="structejdb_1_1transaction__guard.html">transaction_guard</a> gu(my_coll.transaction());</div>
<div class="line">    oid = my_coll.save_document(R<span class="stringliteral">&quot;({&quot;some other key&quot;: &quot;some other value&quot;})&quot;_json_doc.data());</span></div>
<div class="line"><span class="stringliteral">    </span><span class="keywordflow">throw</span> 0;</div>
<div class="line">}</div>
<div class="line"><span class="keywordflow">catch</span>(...) {}</div>
<div class="line"></div>
<div class="line">assert(my_coll.load_document(oid).empty());</div>
<div class="line"></div>
<div class="line"><span class="comment">// Can be manually committed or aborted.</span></div>
<div class="line"><a class="code" href="structejdb_1_1unique__transaction.html">unique_transaction</a> ut(my_coll.transaction());</div>
<div class="line">oid = my_coll.save_document(R<span class="stringliteral">&quot;({&quot;some other key&quot;: &quot;some other value&quot;})&quot;_json_doc.data());</span></div>
<div class="line"><span class="stringliteral">ut.<a class="code" href="structejdb_1_1unique__transaction.html#a21f3584223b39db7951a14835f8a611e">commit</a>();</span></div>
<div class="line"><span class="stringliteral"></span></div>
<div class="line"><span class="stringliteral">assert(!my_coll.load_document(oid).empty());</span></div>
<div class="line"><span class="stringliteral"></span></div>
<div class="line"><span class="stringliteral"></span><span class="comment">// Rebindable.</span></div>
<div class="line">ut = <a class="code" href="structejdb_1_1unique__transaction.html">unique_transaction</a>(my_coll.transaction());</div>
<div class="line">oid = my_coll.save_document(R<span class="stringliteral">&quot;({&quot;some other key&quot;: &quot;some other value&quot;})&quot;_json_doc.data());</span></div>
<div class="line"><span class="stringliteral">ut.<a class="code" href="structejdb_1_1unique__transaction.html#aab4261f4ffcf12e48cac300c3591839a">abort</a>();</span></div>
<div class="line"><span class="stringliteral"></span></div>
<div class="line"><span class="stringliteral">assert(my_coll.load_document(oid).empty());</span></div>
</div><!-- fragment --><h1><a class="anchor" id="install"></a>
Installation</h1>
<h2><a class="anchor" id="reqs"></a>
Requirements</h2>
<ul>
<li>C++11 compliant compiler.</li>
<li>Boost headers. (Uses Boost.Optional, and Boost.Config).</li>
<li><a href="http://www.cmake.org/">cmake</a>.</li>
<li><a href="http://ejdb.org/">EJDB</a>.</li>
</ul>
<h2><a class="anchor" id="build"></a>
Building</h2>
<div class="fragment"><div class="line">mkdir build &amp;&amp; cd build</div>
<div class="line">cmake ..</div>
<div class="line">make</div>
<div class="line">make install</div>
</div><!-- fragment --><p>If EJDB is in a non-standard location, pass <code>EJDB_INCLUDE_DIR</code> and <code>EJDB_LIBRARY_DIR</code> options to cmake. </p><div class="fragment"><div class="line">cmake .. -DEJDB_INCLUDE_DIR=&lt;location-of-tcejdb-header-dir&gt; -DEJDB_LIBRARY_DIR=&lt;location-of-tcejdb-lib-dir&gt;</div>
</div><!-- fragment --><h3><a class="anchor" id="cmake"></a>
CMake Options</h3>
<ul>
<li><code>EJPP_ENABLE_TESTING</code> - set to <code>ON</code> to enable testing. <code>OFF</code> by default. See <a class="el" href="index.html#test">Testing</a>.</li>
<li><code>EJPP_SANITIZE_ADDRESS</code> - set to <code>ON</code> to build with <code>-fsanitize=address</code>. <code>OFF</code> by default.</li>
<li><code>EJPP_LEAK_CHECKER</code> - set to <code>ON</code> to build with <code>-fsanitize=leak</code>. <code>OFF</code> by default.</li>
<li><code>EJPP_DOC_OUTPUT_DIR</code> - set to a path to output generated documentation. <code>./doc</code> by default. See <a class="el" href="index.html#docs">Documentation</a>.</li>
<li><code>EJPP_LIBDIR_SUFFIX</code> - set to a string to add a suffix to the installation library directory, e.g. "64" to install to ${PREFIX}/lib64.</li>
</ul>
<h2><a class="anchor" id="docs"></a>
Documentation</h2>
<p>API documentation can be viewed at <a href="http://chrismanning.github.io/ejpp">http://chrismanning.github.io/ejpp</a> or generated with doxygen. </p><div class="fragment"><div class="line">make doc</div>
</div><!-- fragment --><p> It can then be viewed in a web browser by opening the generated <code>index.html</code>, or any other file.</p>
<h2><a class="anchor" id="test"></a>
Testing</h2>
<p>Unit testing (enabled via <code>EJPP_ENABLE_TESTING</code>) has some additional requirements.</p><ul>
<li>Subversion is needed for downloading google test at build time.</li>
<li><a href="http://chrismanning.github.io/jbson">jbson</a>. This does not have to be installed, its include directory can be specified explicitly via the cmake variable <code>JBSON_INCLUDE_DIR</code>. </li>
</ul>
</div></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.5-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
    Copyright &copy; 2014 <a href="http://www.chrismanning.me.uk/">Christian Manning</a>. </br>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.6
</small></address>
</body>
</html>
